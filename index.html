<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mobile Firster</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <!-- Mobile viewport optimization http://goo.gl/z0PA8 -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="modernizr-2.0.6.js"></script>
    <script type="text/javascript" src="matchMedia.js"></script>
    <script type="text/javascript" src="MobileFirster.js"></script>
    <!--[if IE]>         <script type="text/javascript">Modernizr.addTest('ie', true)   </script><![endif]-->
    <!--[if IE 6]>       <script type="text/javascript">Modernizr.addTest('ie6', true)  </script><![endif]-->
    <!--[if IE 7]>       <script type="text/javascript">Modernizr.addTest('ie7', true)  </script><![endif]-->
    <!--[if IE 8]>       <script type="text/javascript">Modernizr.addTest('ie8', true)  </script><![endif]-->
    <!--[if lt IE 9]>    <script type="text/javascript">Modernizr.addTest('oldie', true)</script><![endif]-->
    <!--[if IE 9]>       <script type="text/javascript">Modernizr.addTest('ie9', true)  </script><![endif]-->
    <!--[if IEMobile]>   <script type="text/javascript">Modernizr.addTest('iem', true)  </script><![endif]-->
    <!--[if IEMobile 7]> <script type="text/javascript">Modernizr.addTest('ie7m', true) </script><![endif]-->
    <!--[if IEMobile 9]> <script type="text/javascript">Modernizr.addTest('ie9m', true) </script><![endif]-->

    <link rel="stylesheet" id="mainCSS" href="css/phone.css">
    <script type="text/javascript">
      (function(){
        // Update Modernizr test when media-queries change
        var smartphoneMq = 'only screen and (max-width: 640px)';
        var tabletMq =     'only screen and (min-width: 641px) and (max-width: 1023px)';
        var desktopMq =    'only screen and (min-width: 1024px)';

        var tests = [
          {phone:         function(){ return (!Modernizr.touch && Modernizr.mq(smartphoneMq)) || Modernizr.iem; } },
          {smartphone:    function(){ return   Modernizr.touch && Modernizr.mq(smartphoneMq); } },
          {tablet:        function(){ return   Modernizr.touch && Modernizr.mq(tabletMq); } },
          {netbook:       function(){ return  !Modernizr.touch && Modernizr.mq(tabletMq); } },
          {desktop:       function(){ return   Modernizr.mq(desktopMq) || (Modernizr.oldie && !Modernizr.iem); } },
          {l:             function(){ return   Modernizr.phone || Modernizr.smartphone; } },
          {m:             function(){ return   Modernizr.netbook; } },
          {h:             function(){ return   Modernizr.tablet || Modernizr.desktop; } }
        ];

        MobileFirster.setCustomTests(tests)
                   .updateWithMediaQuery([smartphoneMq, tabletMq, desktopMq])
                   .addListener(updateCSS)
                   .addListener(updateImage);

        /* Only load the CSS corresponding to a Modernizr test */
        var css = [ 'phone', 'smartphone', 'tablet', 'netbook', 'desktop' ];

        function updateCSS(){
          var cssFolder="css/";
          var cssFile="phone"
          for (var i in css){
            var name = css[i];
            if (Modernizr[name]) cssFile = name ;
          }
          document.getElementById("mainCSS").href = cssFolder + cssFile + '.css';
        };

        /* Load the image corresponding to the Modernizr test */
        var image = ['l', 'm', 'h'];

        function updateImage(){
          var imgDir = '';
          for (var i in image){
            var name = image[i];
            if (Modernizr[name]) imgDir = name ;
          }
          for (var i=0; i<document.images.length; i++){
            var img = document.images[i];
            var src = 'img/' + imgDir + '/' + img.getAttribute('data-src');
            img.setAttribute("src", src);
          }
        }
      })()
    </script>
    <style>
      .touch body {
        background: red;
      }
    </style>
  </head>
  <body>
    <p>
    </p>
    <img src="" data-src="burger.jpg" data-licence="http://www.flickr.com/photos/lilcrabbygal/484635049/" alt="burger" title="burger"/>
  </body>
</html>
